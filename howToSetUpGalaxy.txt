How to set up galaxy for icqsol
===============================

alexander _ at _ gokliya _ dot _ net
Tue Nov 17 14:54:38 MST 2015

$ rhc ssh
> cd $OPENSHIFT_DATA_DIR/source/
> git clone https://github.com/gregvonkuster/galaxy-csg.git
> git clone https://github.com/galaxyproject/galaxy.git
> cd galaxy

Set the port number to the output of 

> env | grep $OPENSHIFT_DIY_IP
OPENSHIFT_DIY_IP=127.9.120.1

Edit config/galaxy.ini

> cp config/galaxy.ini.sample config/galaxy.ini
(edit config/galaxy.ini)
> grep '^host' config/galaxy.ini
host = 127.9.120.1

Install python and dependencies

> sh run.sh

(follow instructions…)

Add the csg to config/tool_conf.xml (and remove unused tools, keep getext)

> cp config/tool_conf.xml.sample config/tool_conf.xml

  <section id="getext" name="Get Data">
    <tool file="data_source/upload.xml" />
  </section>

  <section id="csg" name="CSG">
    <tool file="csg/icqsol_create_shape.xml" />
    <tool file="csg/icqsol_refine_shape.xml" />
    <tool file="csg/icqsol_compose_shapes.xml" />
    <tool file=“csg/icqsol_add_texture.xml” />
    <tool file="csg/icqsol_add_surface_field_from_expression.xml" />
    <tool file="csg/icqsol_color_surface_field.xml" />
    <tool file="csg/icqsol_solve_laplace.xml" />
  </section>

Copy the csg tools from galaxy-csg

> mkdir tools/csg
> for t in solve_laplace add_surface_field_from_expression color_surface_field compose_shapes add_texture create_shape refine_shape translate_shape rotate_shape scale_shape; do cp ../galaxy-csg/tools/icqsol_$t/* tools/csg; done
> cp ../galaxy-csg/tools/* $OPENSHIFT_DATA_DIR/source/galaxy/tools/csg/

(ignore warnings)

Copy the visualization tools 

> mkdir config/plugins/visualizations/csg/
> cp -r ../galaxy-csg/visualizations/csg/* $OPENSHIFT_DATA_DIR/source/galaxy/config/plugins/visualizations/csg/

Create the start/stop hooks

$ cat .openshift/action_hooks/start
sh $OPENSHIFT_DATA_DIR/source/galaxy/run.sh --daemon

$ cat .openshift/action_hooks/stop
sh $OPENSHIFT_DATA_DIR/source/galaxy/run.sh --stop-daemon

The default python on Openshift is 2.6 and this requires a pip install of 
argparse

> .venv/bin/pip install argparse

Test 

> sh run.sh


